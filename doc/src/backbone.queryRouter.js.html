<!DOCTYPE html>
<html>
<head>
  <title>backbone.queryRouter.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = "../", thisFile = "src/backbone.queryRouter.js", defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>backbone.queryRouter.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-1" id="line-1">1</a>  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
<a class="line-num" href="#line-2" id="line-2">2</a>  
<a class="line-num" href="#line-3" id="line-3">3</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>Is there a better way to pick up window globals?</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-3" id="line-3">3</a>  
<a class="line-num" href="#line-4" id="line-4">4</a>  <span class="kd">var</span> <span class="nx">Backbone</span> <span class="o">=</span> <span class="p">(</span><span class="nb">window</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">)</span> <span class="o">||</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;backbone&#39;</span><span class="p">);</span>
<a class="line-num" href="#line-5" id="line-5">5</a>  <span class="kd">var</span> <span class="nx">_</span> <span class="o">=</span> <span class="p">(</span><span class="nb">window</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">_</span><span class="p">)</span> <span class="o">||</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;underscore&#39;</span><span class="p">);</span>
<a class="line-num" href="#line-6" id="line-6">6</a>  <span class="kd">var</span> <span class="nx">querystring</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;qs&#39;</span><span class="p">);</span>
<a class="line-num" href="#line-7" id="line-7">7</a>  <span class="kd">var</span> <span class="nx">diff</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;deep-diff&#39;</span><span class="p">);</span>
<a class="line-num" href="#line-8" id="line-8">8</a>  
<a class="line-num" href="#line-9" id="line-9">9</a>  
<a class="line-num" href="#line-10" id="line-10">10</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Backbone.History overrides.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Type</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Backbone.History
</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-12" id="line-12">12</a>  
<a class="line-num" href="#line-13" id="line-13">13</a>  <span class="kd">var</span> <span class="nx">QueryHistory</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">History</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="cm">/** @lends QueryHistory# **/</span><span class="p">{</span>
<a class="line-num" href="#line-14" id="line-14">14</a>  
<a class="line-num" href="#line-15" id="line-15">15</a>  
<a class="line-num" href="#line-16" id="line-16">16</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Override history constructor to init some properties and set the embedded query 
model listener.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Type</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Backbone.History
</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-20" id="line-20">20</a>  
<a class="line-num" href="#line-21" id="line-21">21</a>    <span class="nx">constructor</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<a class="line-num" href="#line-22" id="line-22">22</a>      <span class="k">this</span><span class="p">.</span><span class="nx">previousQuery</span> <span class="o">=</span> <span class="p">{};</span>
<a class="line-num" href="#line-23" id="line-23">23</a>      <span class="k">this</span><span class="p">.</span><span class="nx">queryHandlers</span> <span class="o">=</span> <span class="p">[];</span>
<a class="line-num" href="#line-24" id="line-24">24</a>      <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onQueryModelChange</span><span class="p">);</span>
<a class="line-num" href="#line-25" id="line-25">25</a>      <span class="nx">Backbone</span><span class="p">.</span><span class="nx">History</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a class="line-num" href="#line-26" id="line-26">26</a>    <span class="p">},</span>
<a class="line-num" href="#line-27" id="line-27">27</a>  
<a class="line-num" href="#line-28" id="line-28">28</a>  
<a class="line-num" href="#line-29" id="line-29">29</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Extracts querystrings from routes.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Type</div>
    <div class="dox_tag_detail">
      <span class="dox_type">RegExp
</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-31" id="line-31">31</a>  
<a class="line-num" href="#line-32" id="line-32">32</a>    <span class="nx">queryMatcher</span><span class="o">:</span> <span class="sr">/^([^?]*?)(?:\?([\s\S]*))?$/</span><span class="p">,</span>
<a class="line-num" href="#line-33" id="line-33">33</a>  
<a class="line-num" href="#line-34" id="line-34">34</a>  
<a class="line-num" href="#line-35" id="line-35">35</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Model emcompassing current query state. You can read and set properties
on this Model and <code>Backbone.history.navigate()</code> will automatically be called.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Type</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Backbone.Model
</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-38" id="line-38">38</a>  
<a class="line-num" href="#line-39" id="line-39">39</a>    <span class="nx">query</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">(),</span>
<a class="line-num" href="#line-40" id="line-40">40</a>  
<a class="line-num" href="#line-41" id="line-41">41</a>  
<a class="line-num" href="#line-42" id="line-42">42</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Parse a fragment into a query object and call handlers matching.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">fragment</span>
      <span class="dox_type">String</span>
      <span>Route fragment.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">options</span>
      <span class="dox_type">Object</span>
      <span>Navigation options.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-45" id="line-45">45</a>  
<a class="line-num" href="#line-46" id="line-46">46</a>    <span class="nx">loadQuery</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fragment</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-47" id="line-47">47</a>      <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_fragmentToQueryObject</span><span class="p">(</span><span class="nx">fragment</span><span class="p">);</span>
<a class="line-num" href="#line-48" id="line-48">48</a>      <span class="kd">var</span> <span class="nx">previous</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">previousQuery</span><span class="p">;</span>
<a class="line-num" href="#line-49" id="line-49">49</a>  
<a class="line-num" href="#line-50" id="line-50">50</a>  
<a class="line-num" href="#line-51" id="line-51">51</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<p>Save previous query.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-50" id="line-50">50</a>  
<a class="line-num" href="#line-51" id="line-51">51</a>      <span class="k">this</span><span class="p">.</span><span class="nx">previousQuery</span> <span class="o">=</span> <span class="nx">query</span><span class="p">;</span>
<a class="line-num" href="#line-52" id="line-52">52</a>  
<a class="line-num" href="#line-53" id="line-53">53</a>  
<a class="line-num" href="#line-54" id="line-54">54</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>Diff new and old queries.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-53" id="line-53">53</a>  
<a class="line-num" href="#line-54" id="line-54">54</a>      <span class="kd">var</span> <span class="nx">diffs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getDiffs</span><span class="p">(</span><span class="nx">previous</span><span class="p">,</span> <span class="nx">query</span><span class="p">);</span>
<a class="line-num" href="#line-55" id="line-55">55</a>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">diffs</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
<a class="line-num" href="#line-56" id="line-56">56</a>  
<a class="line-num" href="#line-57" id="line-57">57</a>  
<a class="line-num" href="#line-58" id="line-58">58</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<p>Set embedded model to new query object, firing 'change' events.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-57" id="line-57">57</a>  
<a class="line-num" href="#line-58" id="line-58">58</a>      <span class="k">this</span><span class="p">.</span><span class="nx">stopListening</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onQueryModelChange</span><span class="p">);</span>
<a class="line-num" href="#line-59" id="line-59">59</a>      <span class="k">this</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>
<a class="line-num" href="#line-60" id="line-60">60</a>      <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onQueryModelChange</span><span class="p">);</span>
<a class="line-num" href="#line-61" id="line-61">61</a>  
<a class="line-num" href="#line-62" id="line-62">62</a>  
<a class="line-num" href="#line-63" id="line-63">63</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>Call each function that subscribes to these items.
This is intentional, rather than fire events on each changed item;
this way, you don't have to debounce your handlers since they are only called once,
even if multiple query items change.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-65" id="line-65">65</a>  
<a class="line-num" href="#line-66" id="line-66">66</a>      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">queryHandlers</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-67" id="line-67">67</a>        <span class="kd">var</span> <span class="nx">intersections</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">intersection</span><span class="p">(</span><span class="nx">diffs</span><span class="p">,</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">bindings</span><span class="p">);</span>
<a class="line-num" href="#line-68" id="line-68">68</a>        <span class="k">if</span> <span class="p">(</span><span class="nx">intersections</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-69" id="line-69">69</a>          <span class="nx">handler</span><span class="p">.</span><span class="nx">callback</span><span class="p">(</span><span class="nx">fragment</span><span class="p">,</span> <span class="nx">_</span><span class="p">.</span><span class="nx">pick</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">intersections</span><span class="p">));</span>
<a class="line-num" href="#line-70" id="line-70">70</a>        <span class="p">}</span>
<a class="line-num" href="#line-71" id="line-71">71</a>      <span class="p">});</span>
<a class="line-num" href="#line-72" id="line-72">72</a>    <span class="p">},</span>
<a class="line-num" href="#line-73" id="line-73">73</a>  
<a class="line-num" href="#line-74" id="line-74">74</a>  
<a class="line-num" href="#line-75" id="line-75">75</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Override loadUrl &amp; watch return value. Trigger event if no route was matched.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Boolean</span>
      <span>True if a route was matched.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-77" id="line-77">77</a>  
<a class="line-num" href="#line-78" id="line-78">78</a>    <span class="nx">loadUrl</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<a class="line-num" href="#line-79" id="line-79">79</a>      <span class="kd">var</span> <span class="nx">matched</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">History</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadUrl</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
<a class="line-num" href="#line-80" id="line-80">80</a>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">matched</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-81" id="line-81">81</a>        <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;routeNotFound&#39;</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
<a class="line-num" href="#line-82" id="line-82">82</a>      <span class="p">}</span>
<a class="line-num" href="#line-83" id="line-83">83</a>      <span class="k">return</span> <span class="nx">matched</span><span class="p">;</span>
<a class="line-num" href="#line-84" id="line-84">84</a>    <span class="p">},</span>
<a class="line-num" href="#line-85" id="line-85">85</a>  
<a class="line-num" href="#line-86" id="line-86">86</a>  
<a class="line-num" href="#line-87" id="line-87">87</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Add loadQuery hook.
Add 'forceTrigger' option that will trigger a route regardless of whether 
or not we're already at that route.
Also trigger '[before, after]Navigate' event.</p>
  </div>
  <div class="body"><p>Backbone.History is the prototype name, Backbone.history is the actual object, 
but Backbone.History stores the 'started' flag. Whatever.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">fragment</span>
      <span class="dox_type">String</span>
      <span>History fragment.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">options</span>
      <span class="dox_type">Object</span>
      <span>Navigation options.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-96" id="line-96">96</a>  
<a class="line-num" href="#line-97" id="line-97">97</a>    <span class="nx">navigate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fragment</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-98" id="line-98">98</a>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">History</span><span class="p">.</span><span class="nx">started</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<a class="line-num" href="#line-99" id="line-99">99</a>  
<a class="line-num" href="#line-100" id="line-100">100</a>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span>
<a class="line-num" href="#line-101" id="line-101">101</a>  
<a class="line-num" href="#line-102" id="line-102">102</a>  
<a class="line-num" href="#line-103" id="line-103">103</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<p>Throw a navigate route so we can hook to this elsewhere in the app.
This is usually the event you'll want to listen to.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-103" id="line-103">103</a>  
<a class="line-num" href="#line-104" id="line-104">104</a>      <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;beforeNavigate&#39;</span><span class="p">,</span> <span class="nx">fragment</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<a class="line-num" href="#line-105" id="line-105">105</a>  
<a class="line-num" href="#line-106" id="line-106">106</a>  
<a class="line-num" href="#line-107" id="line-107">107</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<p>Fire querystring routes.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-106" id="line-106">106</a>  
<a class="line-num" href="#line-107" id="line-107">107</a>      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">trigger</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-108" id="line-108">108</a>        <span class="k">this</span><span class="p">.</span><span class="nx">loadQuery</span><span class="p">(</span><span class="nx">fragment</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<a class="line-num" href="#line-109" id="line-109">109</a>      <span class="p">}</span>
<a class="line-num" href="#line-110" id="line-110">110</a>  
<a class="line-num" href="#line-111" id="line-111">111</a>  
<a class="line-num" href="#line-112" id="line-112">112</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<p>Support 'forceTrigger' to trigger a route even if the url hasn't changed.
Have to check History.started here if we call loadUrl directly.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-112" id="line-112">112</a>  
<a class="line-num" href="#line-113" id="line-113">113</a>      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">forceTrigger</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">fragment</span> <span class="o">===</span> <span class="nx">fragment</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-114" id="line-114">114</a>        <span class="k">this</span><span class="p">.</span><span class="nx">loadUrl</span><span class="p">(</span><span class="nx">fragment</span><span class="p">);</span>
<a class="line-num" href="#line-115" id="line-115">115</a>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<a class="line-num" href="#line-116" id="line-116">116</a>  
<a class="line-num" href="#line-117" id="line-117">117</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>Call navigate on prototype since we just overrode it.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-116" id="line-116">116</a>  
<a class="line-num" href="#line-117" id="line-117">117</a>        <span class="nx">Backbone</span><span class="p">.</span><span class="nx">History</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">navigate</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">fragment</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<a class="line-num" href="#line-118" id="line-118">118</a>      <span class="p">}</span>
<a class="line-num" href="#line-119" id="line-119">119</a>  
<a class="line-num" href="#line-120" id="line-120">120</a>  
<a class="line-num" href="#line-121" id="line-121">121</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>Throw an 'afterNavigate' route for those who care.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-120" id="line-120">120</a>  
<a class="line-num" href="#line-121" id="line-121">121</a>      <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;afterNavigate&#39;</span><span class="p">,</span> <span class="nx">fragment</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<a class="line-num" href="#line-122" id="line-122">122</a>    <span class="p">},</span>
<a class="line-num" href="#line-123" id="line-123">123</a>  
<a class="line-num" href="#line-124" id="line-124">124</a>  
<a class="line-num" href="#line-125" id="line-125">125</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>When the query model changes, run all associated routes.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{Model}  model   Attached model.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{Object} options Change options.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-128" id="line-128">128</a>  
<a class="line-num" href="#line-129" id="line-129">129</a>    <span class="nx">onQueryModelChange</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-130" id="line-130">130</a>      <span class="kd">var</span> <span class="nx">fragment</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fragment</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<a class="line-num" href="#line-131" id="line-131">131</a>      <span class="kd">var</span> <span class="nx">oldQS</span> <span class="o">=</span> <span class="nx">querystring</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">previousQuery</span><span class="p">);</span>
<a class="line-num" href="#line-132" id="line-132">132</a>      <span class="kd">var</span> <span class="nx">newQS</span> <span class="o">=</span> <span class="nx">querystring</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">());</span>
<a class="line-num" href="#line-133" id="line-133">133</a>      <span class="k">this</span><span class="p">.</span><span class="nx">navigate</span><span class="p">(</span><span class="nx">fragment</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">oldQS</span><span class="p">,</span> <span class="nx">newQS</span><span class="p">),</span> <span class="p">{</span><span class="nx">trigger</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
<a class="line-num" href="#line-134" id="line-134">134</a>    <span class="p">},</span>
<a class="line-num" href="#line-135" id="line-135">135</a>  
<a class="line-num" href="#line-136" id="line-136">136</a>  
<a class="line-num" href="#line-137" id="line-137">137</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Add a query to be tested when the fragment changes.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{Array}   bindings  Query keys to listen to.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{Function} callback Callback to call when these keys change.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-140" id="line-140">140</a>  
<a class="line-num" href="#line-141" id="line-141">141</a>    <span class="nx">queryHandler</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">bindings</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-142" id="line-142">142</a>      <span class="k">this</span><span class="p">.</span><span class="nx">queryHandlers</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">bindings</span><span class="o">:</span> <span class="nx">bindings</span><span class="p">,</span> <span class="nx">callback</span><span class="o">:</span> <span class="nx">callback</span><span class="p">});</span>
<a class="line-num" href="#line-143" id="line-143">143</a>    <span class="p">},</span>
<a class="line-num" href="#line-144" id="line-144">144</a>  
<a class="line-num" href="#line-145" id="line-145">145</a>  
<a class="line-num" href="#line-146" id="line-146">146</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Given two objects, compute their differences and list them.
When diffing deep objects, return one string for the object and one for each child.
This allows functions to bind to deep properties or its parent.
E.g. a change to a.b.c returns ['a', 'a.b', 'a.b.c']</p>
  </div>
  <div class="body"><p>This uses DeepDiff (flitbit/diff), which can detect changes deep within objects.
We don't use objects in querystrings quite yet, but we do arrays. And that might change.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{Object} lhs Left hand object.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{Object} rhs Right hand (new) object.</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Array</span>
      <span>Array of string differences.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-161" id="line-161">161</a>  
<a class="line-num" href="#line-162" id="line-162">162</a>    <span class="nx">_getDiffs</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">lhs</span><span class="p">,</span> <span class="nx">rhs</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-163" id="line-163">163</a>      <span class="kd">var</span> <span class="nx">diffs</span> <span class="o">=</span> <span class="nx">diff</span><span class="p">(</span><span class="nx">lhs</span><span class="p">,</span> <span class="nx">rhs</span><span class="p">);</span>
<a class="line-num" href="#line-164" id="line-164">164</a>      <span class="kd">var</span> <span class="nx">diffKeys</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="nx">diffs</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">diff</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-165" id="line-165">165</a>        <span class="kd">var</span> <span class="nx">paths</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">diff</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-166" id="line-166">166</a>          <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">first</span><span class="p">(</span><span class="nx">diff</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
<a class="line-num" href="#line-167" id="line-167">167</a>        <span class="p">});</span>
<a class="line-num" href="#line-168" id="line-168">168</a>        <span class="k">return</span> <span class="nx">result</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">paths</span><span class="p">);</span>
<a class="line-num" href="#line-169" id="line-169">169</a>      <span class="p">},</span> <span class="p">[]);</span>
<a class="line-num" href="#line-170" id="line-170">170</a>      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">uniq</span><span class="p">(</span><span class="nx">diffKeys</span><span class="p">);</span>
<a class="line-num" href="#line-171" id="line-171">171</a>    <span class="p">},</span>
<a class="line-num" href="#line-172" id="line-172">172</a>  
<a class="line-num" href="#line-173" id="line-173">173</a>  
<a class="line-num" href="#line-174" id="line-174">174</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Given a fragment, return a query object.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{String} fragment Route fragment.</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Object</span>
      <span>Query object.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-177" id="line-177">177</a>  
<a class="line-num" href="#line-178" id="line-178">178</a>    <span class="nx">_fragmentToQueryObject</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fragment</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-179" id="line-179">179</a>      <span class="k">return</span> <span class="nx">querystring</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_fragmentToQueryString</span><span class="p">(</span><span class="nx">fragment</span><span class="p">));</span>
<a class="line-num" href="#line-180" id="line-180">180</a>    <span class="p">},</span>
<a class="line-num" href="#line-181" id="line-181">181</a>  
<a class="line-num" href="#line-182" id="line-182">182</a>  
<a class="line-num" href="#line-183" id="line-183">183</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Given a fragment, return a query string.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{String} fragment Route fragment.</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">String</span>
      <span>Query string.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-186" id="line-186">186</a>  
<a class="line-num" href="#line-187" id="line-187">187</a>    <span class="nx">_fragmentToQueryString</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fragment</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-188" id="line-188">188</a>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">fragment</span><span class="p">)</span> <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<a class="line-num" href="#line-189" id="line-189">189</a>      <span class="kd">var</span> <span class="nx">match</span> <span class="o">=</span> <span class="nx">fragment</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">queryMatcher</span><span class="p">);</span>
<a class="line-num" href="#line-190" id="line-190">190</a>      <span class="k">return</span> <span class="nx">match</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<a class="line-num" href="#line-191" id="line-191">191</a>    <span class="p">}</span>
<a class="line-num" href="#line-192" id="line-192">192</a>  <span class="p">});</span>
<a class="line-num" href="#line-193" id="line-193">193</a>  
<a class="line-num" href="#line-194" id="line-194">194</a>  <span class="kd">var</span> <span class="nx">RouterProto</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<a class="line-num" href="#line-195" id="line-195">195</a>  
<a class="line-num" href="#line-196" id="line-196">196</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Backbone.Router overrides.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Type</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Backbone.Router
</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-198" id="line-198">198</a>  
<a class="line-num" href="#line-199" id="line-199">199</a>  <span class="kd">var</span> <span class="nx">QueryRouter</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="cm">/** @lends QueryRouter# */</span><span class="p">{</span>
<a class="line-num" href="#line-200" id="line-200">200</a>  
<a class="line-num" href="#line-201" id="line-201">201</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Bind query routes.</p>
  </div>
  <div class="body"><p>Remember that handlers will only fire once per navigation. If for some reason you'd like
a handler to fire for each individual change, bind to the 'change:{key}' events on 
Backbone.history.query, which is just a Backbone.Model (and fires all of the usual
events).</p>

<p>They are expected to be attached in the following configuration:</p>


<div class="highlight"><pre><code><span class="nx">queryRoutes</span><span class="o">:</span> <span class="p">[</span>
  <span class="s1">&#39;key1,key2,key3&#39;</span><span class="o">:</span> <span class="s1">&#39;handlerName&#39;</span><span class="p">,</span>
  <span class="s1">&#39;q, sort, rows&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// ... },</span>
  <span class="s1">&#39;nested.object&#39;</span><span class="o">:</span> <span class="s1">&#39;deepHandler&#39;</span>
<span class="p">]</span>
</code></pre></div>


  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-217" id="line-217">217</a>  
<a class="line-num" href="#line-218" id="line-218">218</a>    <span class="nx">_bindRoutes</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<a class="line-num" href="#line-219" id="line-219">219</a>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">queryRoutes</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
<a class="line-num" href="#line-220" id="line-220">220</a>      <span class="k">this</span><span class="p">.</span><span class="nx">queryRoutes</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">result</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;queryRoutes&#39;</span><span class="p">);</span>
<a class="line-num" href="#line-221" id="line-221">221</a>      <span class="kd">var</span> <span class="nx">qRoute</span><span class="p">,</span> <span class="nx">qRoutes</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">queryRoutes</span><span class="p">);</span>
<a class="line-num" href="#line-222" id="line-222">222</a>      <span class="k">while</span> <span class="p">((</span><span class="nx">qRoute</span> <span class="o">=</span> <span class="nx">qRoutes</span><span class="p">.</span><span class="nx">pop</span><span class="p">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-223" id="line-223">223</a>        <span class="k">this</span><span class="p">.</span><span class="nx">queryHandler</span><span class="p">(</span><span class="nx">qRoute</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">queryRoutes</span><span class="p">[</span><span class="nx">qRoute</span><span class="p">]);</span>
<a class="line-num" href="#line-224" id="line-224">224</a>      <span class="p">}</span>
<a class="line-num" href="#line-225" id="line-225">225</a>      <span class="nx">RouterProto</span><span class="p">.</span><span class="nx">_bindRoutes</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
<a class="line-num" href="#line-226" id="line-226">226</a>    <span class="p">},</span>
<a class="line-num" href="#line-227" id="line-227">227</a>  
<a class="line-num" href="#line-228" id="line-228">228</a>  
<a class="line-num" href="#line-229" id="line-229">229</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Bind a queryHandler. Very similar to Backbone.Router#route, except that args
are provided by Backbone.history#queryHandler, rather than being extracted
in the router from the fragment.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{String|array}  bindings Query key bindings.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{String}   [name]        Listener name.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{Function} callback      Listener callback.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-235" id="line-235">235</a>  
<a class="line-num" href="#line-236" id="line-236">236</a>    <span class="nx">queryHandler</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">bindings</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-237" id="line-237">237</a>      <span class="nx">bindings</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_normalizeBindings</span><span class="p">(</span><span class="nx">bindings</span><span class="p">);</span>
<a class="line-num" href="#line-238" id="line-238">238</a>      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">name</span><span class="p">))</span> <span class="p">{</span>
<a class="line-num" href="#line-239" id="line-239">239</a>        <span class="nx">callback</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
<a class="line-num" href="#line-240" id="line-240">240</a>        <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<a class="line-num" href="#line-241" id="line-241">241</a>      <span class="p">}</span>
<a class="line-num" href="#line-242" id="line-242">242</a>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">callback</span><span class="p">)</span> <span class="nx">callback</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
<a class="line-num" href="#line-243" id="line-243">243</a>      <span class="kd">var</span> <span class="nx">router</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
<a class="line-num" href="#line-244" id="line-244">244</a>      <span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">queryHandler</span><span class="p">(</span><span class="nx">bindings</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fragment</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-245" id="line-245">245</a>        <span class="nx">router</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="p">[</span><span class="nx">args</span><span class="p">]);</span>
<a class="line-num" href="#line-246" id="line-246">246</a>        <span class="nx">router</span><span class="p">.</span><span class="nx">trigger</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">router</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;route:&#39;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">].</span><span class="nx">concat</span><span class="p">(</span><span class="nx">args</span><span class="p">));</span>
<a class="line-num" href="#line-247" id="line-247">247</a>        <span class="nx">router</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;route&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
<a class="line-num" href="#line-248" id="line-248">248</a>        <span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;route&#39;</span><span class="p">,</span> <span class="nx">router</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
<a class="line-num" href="#line-249" id="line-249">249</a>      <span class="p">});</span>
<a class="line-num" href="#line-250" id="line-250">250</a>      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<a class="line-num" href="#line-251" id="line-251">251</a>    <span class="p">},</span>
<a class="line-num" href="#line-252" id="line-252">252</a>  
<a class="line-num" href="#line-253" id="line-253">253</a>  
<a class="line-num" href="#line-254" id="line-254">254</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Normalize bindings - convert to array and trim whitespace.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{String} bindings Bindings definition.</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Array</span>
      <span>Normalized bindings.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-257" id="line-257">257</a>  
<a class="line-num" href="#line-258" id="line-258">258</a>    <span class="nx">_normalizeBindings</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">bindings</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-259" id="line-259">259</a>      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">bindings</span><span class="p">))</span> <span class="p">{</span>
<a class="line-num" href="#line-260" id="line-260">260</a>        <span class="nx">bindings</span> <span class="o">=</span> <span class="nx">bindings</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">);</span>
<a class="line-num" href="#line-261" id="line-261">261</a>      <span class="p">}</span>
<a class="line-num" href="#line-262" id="line-262">262</a>      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="nx">bindings</span><span class="p">,</span> <span class="s1">&#39;trim&#39;</span><span class="p">);</span>
<a class="line-num" href="#line-263" id="line-263">263</a>    <span class="p">}</span>
<a class="line-num" href="#line-264" id="line-264">264</a>  <span class="p">});</span>
<a class="line-num" href="#line-265" id="line-265">265</a>  
<a class="line-num" href="#line-266" id="line-266">266</a>  
<a class="line-num" href="#line-267" id="line-267">267</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28">&#182;</a>
</div>
<p>Override default Backbone.Router constructor.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-266" id="line-266">266</a>  
<a class="line-num" href="#line-267" id="line-267">267</a>  <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Router</span> <span class="o">=</span> <span class="nx">QueryRouter</span><span class="p">;</span>
<a class="line-num" href="#line-268" id="line-268">268</a>  
<a class="line-num" href="#line-269" id="line-269">269</a>  
<a class="line-num" href="#line-270" id="line-270">270</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29">&#182;</a>
</div>
<p>Replace Backbone.history.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-269" id="line-269">269</a>  
<a class="line-num" href="#line-270" id="line-270">270</a>  <span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">QueryHistory</span><span class="p">();</span>
<a class="line-num" href="#line-271" id="line-271">271</a>  </pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
