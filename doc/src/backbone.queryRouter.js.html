<!DOCTYPE html>
<html>
<head>
  <title>backbone.queryRouter.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = "../", thisFile = "src/backbone.queryRouter.js", defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h2">
        <a href="#introduction">Introduction</a>
      </div>
      <div class="heading h2">
        <a href="#example">Example</a>
      </div>
      <div class="heading h2">
        <a href="#annotated%20code">Annotated Code</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
<div class="pilwrap" id="introduction">
  <h2>
    <a href="#introduction" name="introduction" class="pilcrow">&#182;</a>
    Introduction
  </h2>
</div>


<p>Modern web applications have many moving parts, and traditional webapp routing is far too restrictive
to deal with real-world apps.</p>

<p>A modern webapp may have many independent bits of serializable state that must be correctly transmitted
when a URL is sent to another user. For example, a music app may want to send the current song, position within
the song, and location within a browsing window. A search app may want to transmit the current query,
selected results, expansion of those results, and user preferences.</p>

<p>It is not always possible to store complex state in localStorage or cookies, if you want to transmit that
complex state to other users via a URL. It can very quickly become unwieldy to create massive 'multi-routes',
where sections of the URL delegate to subrouters. Every time a new widget with state is added, a new 
section must be added to the route, and all links updated.</p>

<p>Querystrings are a perfect solution to this problem, and with HTML5 pushState, they can easily be used
on the client and the server.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-17" id="line-17">17</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="example">
  <h2>
    <a href="#example" name="example" class="pilcrow">&#182;</a>
    Example
  </h2>
</div>



<div class="highlight"><pre><code><span class="kd">var</span> <span class="nx">QueryAwareRouter</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>

  <span class="c1">// Normal routes definition - this is unchanged.</span>
  <span class="nx">routes</span><span class="o">:</span> <span class="p">{</span>
    <span class="p">...</span>
  <span class="p">},</span>

  <span class="c1">// QueryRoutes are defined here. They are defined in </span>
  <span class="c1">// the format:</span>
  <span class="c1">// {String} keys : {String} handlerName</span>
  <span class="nx">queryRoutes</span><span class="o">:</span> <span class="p">{</span>
    <span class="c1">// Here you can specify which keys you want to listen to.</span>
    <span class="c1">// The attached handler will be fired each time any of </span>
    <span class="c1">// the keys are added, removed, or changed.</span>
    <span class="s1">&#39;volume&#39;</span><span class="o">:</span> <span class="s1">&#39;setVolume&#39;</span><span class="p">,</span>
    <span class="c1">// To listen to multiple keys, separate them with commas. </span>
    <span class="c1">// Whitespace is ignored.</span>
    <span class="s1">&#39;playState, songID&#39;</span> <span class="o">:</span> <span class="s1">&#39;playSong&#39;</span>
  <span class="p">},</span>
  <span class="c1">// handler definitions...</span>
<span class="p">});</span>
</code></pre></div>


        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-43" id="line-43">43</a>  
<a class="line-num" href="#line-44" id="line-44">44</a>  
<a class="line-num" href="#line-45" id="line-45">45</a>  
<a class="line-num" href="#line-46" id="line-46">46</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="annotated%20code">
  <h2>
    <a href="#annotated%20code" name="annotated%20code" class="pilcrow">&#182;</a>
    Annotated Code
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-45" id="line-45">45</a>  
<a class="line-num" href="#line-46" id="line-46">46</a>  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span>
<a class="line-num" href="#line-47" id="line-47">47</a>  
<a class="line-num" href="#line-48" id="line-48">48</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<p>CommonJS includes. This is a browserify module and will run both inside Node and in the browser.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-47" id="line-47">47</a>  
<a class="line-num" href="#line-48" id="line-48">48</a>  <span class="kd">var</span> <span class="nx">Backbone</span> <span class="o">=</span> <span class="p">(</span><span class="nb">window</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">Backbone</span><span class="p">)</span> <span class="o">||</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;backbone&#39;</span><span class="p">);</span>
<a class="line-num" href="#line-49" id="line-49">49</a>  <span class="kd">var</span> <span class="nx">_</span> <span class="o">=</span> <span class="p">(</span><span class="nb">window</span> <span class="o">&amp;&amp;</span> <span class="nb">window</span><span class="p">.</span><span class="nx">_</span><span class="p">)</span> <span class="o">||</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;underscore&#39;</span><span class="p">);</span>
<a class="line-num" href="#line-50" id="line-50">50</a>  <span class="kd">var</span> <span class="nx">querystring</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;querystring&#39;</span><span class="p">);</span>
<a class="line-num" href="#line-51" id="line-51">51</a>  
<a class="line-num" href="#line-52" id="line-52">52</a>  
<a class="line-num" href="#line-53" id="line-53">53</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Backbone.History overrides.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Type</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Backbone.History
</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-55" id="line-55">55</a>  
<a class="line-num" href="#line-56" id="line-56">56</a>  <span class="kd">var</span> <span class="nx">QueryHistory</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">History</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span> <span class="cm">/** @lends QueryHistory# **/</span><span class="p">{</span>
<a class="line-num" href="#line-57" id="line-57">57</a>  
<a class="line-num" href="#line-58" id="line-58">58</a>  
<a class="line-num" href="#line-59" id="line-59">59</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Override history constructor to init some properties and set the embedded query 
model listener.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Type</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Backbone.History
</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-63" id="line-63">63</a>  
<a class="line-num" href="#line-64" id="line-64">64</a>    <span class="nx">constructor</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<a class="line-num" href="#line-65" id="line-65">65</a>      <span class="k">this</span><span class="p">.</span><span class="nx">previousQuery</span> <span class="o">=</span> <span class="p">{};</span>
<a class="line-num" href="#line-66" id="line-66">66</a>      <span class="k">this</span><span class="p">.</span><span class="nx">queryHandlers</span> <span class="o">=</span> <span class="p">[];</span>
<a class="line-num" href="#line-67" id="line-67">67</a>      <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onQueryModelChange</span><span class="p">);</span>
<a class="line-num" href="#line-68" id="line-68">68</a>  
<a class="line-num" href="#line-69" id="line-69">69</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<p>Bind a nice toString() method for use on the query object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-68" id="line-68">68</a>  
<a class="line-num" href="#line-69" id="line-69">69</a>      <span class="k">this</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">toString</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<a class="line-num" href="#line-70" id="line-70">70</a>        <span class="k">return</span> <span class="nx">querystring</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">attributes</span><span class="p">);</span>
<a class="line-num" href="#line-71" id="line-71">71</a>      <span class="p">};</span>
<a class="line-num" href="#line-72" id="line-72">72</a>      <span class="nx">Backbone</span><span class="p">.</span><span class="nx">History</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a class="line-num" href="#line-73" id="line-73">73</a>    <span class="p">},</span>
<a class="line-num" href="#line-74" id="line-74">74</a>  
<a class="line-num" href="#line-75" id="line-75">75</a>  
<a class="line-num" href="#line-76" id="line-76">76</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Extracts querystrings from routes.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Type</div>
    <div class="dox_tag_detail">
      <span class="dox_type">RegExp
</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-78" id="line-78">78</a>  
<a class="line-num" href="#line-79" id="line-79">79</a>    <span class="nx">queryMatcher</span><span class="o">:</span> <span class="sr">/^([^?]*?)(?:\?([\s\S]*))?$/</span><span class="p">,</span>
<a class="line-num" href="#line-80" id="line-80">80</a>  
<a class="line-num" href="#line-81" id="line-81">81</a>  
<a class="line-num" href="#line-82" id="line-82">82</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Model emcompassing current query state. You can read and set properties
on this Model and <code>Backbone.history.navigate()</code> will automatically be called.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Type</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Backbone.Model
</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-85" id="line-85">85</a>  
<a class="line-num" href="#line-86" id="line-86">86</a>    <span class="nx">query</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">(),</span>
<a class="line-num" href="#line-87" id="line-87">87</a>  
<a class="line-num" href="#line-88" id="line-88">88</a>    <span class="nx">getBaseRoute</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<a class="line-num" href="#line-89" id="line-89">89</a>      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_stripQuery</span><span class="p">(</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">fragment</span><span class="p">);</span>
<a class="line-num" href="#line-90" id="line-90">90</a>    <span class="p">},</span>
<a class="line-num" href="#line-91" id="line-91">91</a>  
<a class="line-num" href="#line-92" id="line-92">92</a>  
<a class="line-num" href="#line-93" id="line-93">93</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Parse a fragment into a query object and call handlers matching.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">[fragment]</span>
      <span class="dox_type">String</span>
      <span>Route fragment.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-95" id="line-95">95</a>  
<a class="line-num" href="#line-96" id="line-96">96</a>    <span class="nx">loadQuery</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fragment</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-97" id="line-97">97</a>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">fragment</span><span class="p">)</span> <span class="nx">fragment</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fragment</span><span class="p">;</span>
<a class="line-num" href="#line-98" id="line-98">98</a>  
<a class="line-num" href="#line-99" id="line-99">99</a>  
<a class="line-num" href="#line-100" id="line-100">100</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>Ensure the query model is up to date with the fragment. This is potentially redundant
but must be in place in case <code>loadQuery</code> is called directly.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-100" id="line-100">100</a>  
<a class="line-num" href="#line-101" id="line-101">101</a>      <span class="k">this</span><span class="p">.</span><span class="nx">_syncQueryModelFromFragment</span><span class="p">(</span><span class="nx">fragment</span><span class="p">);</span>
<a class="line-num" href="#line-102" id="line-102">102</a>  
<a class="line-num" href="#line-103" id="line-103">103</a>      <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">toJSON</span><span class="p">();</span>
<a class="line-num" href="#line-104" id="line-104">104</a>      <span class="kd">var</span> <span class="nx">previous</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">previousQuery</span><span class="p">;</span>
<a class="line-num" href="#line-105" id="line-105">105</a>  
<a class="line-num" href="#line-106" id="line-106">106</a>  
<a class="line-num" href="#line-107" id="line-107">107</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<p>Save previous query. We intentionally do not use <code>this.query.previousAttributes()</code>, as
it can be overwritten by a user set.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-107" id="line-107">107</a>  
<a class="line-num" href="#line-108" id="line-108">108</a>      <span class="k">this</span><span class="p">.</span><span class="nx">previousQuery</span> <span class="o">=</span> <span class="nx">query</span><span class="p">;</span>
<a class="line-num" href="#line-109" id="line-109">109</a>  
<a class="line-num" href="#line-110" id="line-110">110</a>  
<a class="line-num" href="#line-111" id="line-111">111</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>Diff new and old queries.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-110" id="line-110">110</a>  
<a class="line-num" href="#line-111" id="line-111">111</a>      <span class="kd">var</span> <span class="nx">diffs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getDiffs</span><span class="p">(</span><span class="nx">previous</span><span class="p">,</span> <span class="nx">query</span><span class="p">);</span>
<a class="line-num" href="#line-112" id="line-112">112</a>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">diffs</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
<a class="line-num" href="#line-113" id="line-113">113</a>  
<a class="line-num" href="#line-114" id="line-114">114</a>  
<a class="line-num" href="#line-115" id="line-115">115</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<p>Call each function that subscribes to these items.
This is intentional, rather than fire events on each changed item;
this way, you don't have to debounce your handlers since they are only called once,
even if multiple query items change.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-117" id="line-117">117</a>  
<a class="line-num" href="#line-118" id="line-118">118</a>      <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">queryHandlers</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">handler</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-119" id="line-119">119</a>        <span class="kd">var</span> <span class="nx">intersections</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">intersection</span><span class="p">(</span><span class="nx">diffs</span><span class="p">,</span> <span class="nx">handler</span><span class="p">.</span><span class="nx">bindings</span><span class="p">);</span>
<a class="line-num" href="#line-120" id="line-120">120</a>        <span class="k">if</span> <span class="p">(</span><span class="nx">intersections</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-121" id="line-121">121</a>          <span class="nx">handler</span><span class="p">.</span><span class="nx">callback</span><span class="p">(</span><span class="nx">fragment</span><span class="p">,</span> <span class="nx">query</span><span class="p">,</span> <span class="nx">intersections</span><span class="p">);</span>
<a class="line-num" href="#line-122" id="line-122">122</a>        <span class="p">}</span>
<a class="line-num" href="#line-123" id="line-123">123</a>      <span class="p">});</span>
<a class="line-num" href="#line-124" id="line-124">124</a>    <span class="p">},</span>
<a class="line-num" href="#line-125" id="line-125">125</a>  
<a class="line-num" href="#line-126" id="line-126">126</a>  
<a class="line-num" href="#line-127" id="line-127">127</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Compare previous base fragment to current base fragment. If it is the same,
do not fire the url handler.</p>
  </div>
  <div class="body"><p>This is intended so that you can use <code>navigate</code> to change a query without
worrying about refiring route handlers.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{String} fragment History fragment.</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Boolean</span>
      <span>True if a route was matched or if it hasn't changed. This allows you
  to still bind listeners that look for unmatched routes, e.g. backbone.routeNotFound.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-136" id="line-136">136</a>  
<a class="line-num" href="#line-137" id="line-137">137</a>    <span class="nx">loadUrl</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fragment</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-138" id="line-138">138</a>      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_previousBaseFragment</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">_stripQuery</span><span class="p">(</span><span class="nx">fragment</span><span class="p">))</span> <span class="p">{</span>
<a class="line-num" href="#line-139" id="line-139">139</a>        <span class="k">return</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">History</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadUrl</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
<a class="line-num" href="#line-140" id="line-140">140</a>      <span class="p">}</span>
<a class="line-num" href="#line-141" id="line-141">141</a>      <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<a class="line-num" href="#line-142" id="line-142">142</a>    <span class="p">},</span>
<a class="line-num" href="#line-143" id="line-143">143</a>  
<a class="line-num" href="#line-144" id="line-144">144</a>  
<a class="line-num" href="#line-145" id="line-145">145</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Add loadQuery hook.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">fragment</span>
      <span class="dox_type">String</span>
      <span>History fragment.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">options</span>
      <span class="dox_type">Object</span>
      <span>Navigation options.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-149" id="line-149">149</a>  
<a class="line-num" href="#line-150" id="line-150">150</a>    <span class="nx">navigate</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fragment</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-151" id="line-151">151</a>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">History</span><span class="p">.</span><span class="nx">started</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<a class="line-num" href="#line-152" id="line-152">152</a>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span> <span class="o">||</span> <span class="nx">options</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span><span class="nx">trigger</span><span class="o">:</span> <span class="o">!!</span><span class="nx">options</span><span class="p">};</span>
<a class="line-num" href="#line-153" id="line-153">153</a>  
<a class="line-num" href="#line-154" id="line-154">154</a>  
<a class="line-num" href="#line-155" id="line-155">155</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>Save base fragment for comparison in loadUrl.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-154" id="line-154">154</a>  
<a class="line-num" href="#line-155" id="line-155">155</a>      <span class="k">this</span><span class="p">.</span><span class="nx">_previousBaseFragment</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_stripQuery</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">fragment</span><span class="p">);</span>
<a class="line-num" href="#line-156" id="line-156">156</a>  
<a class="line-num" href="#line-157" id="line-157">157</a>  
<a class="line-num" href="#line-158" id="line-158">158</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>Call navigate on prototype.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-157" id="line-157">157</a>  
<a class="line-num" href="#line-158" id="line-158">158</a>      <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">History</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">navigate</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">fragment</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<a class="line-num" href="#line-159" id="line-159">159</a>  
<a class="line-num" href="#line-160" id="line-160">160</a>  
<a class="line-num" href="#line-161" id="line-161">161</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<p>Synchronize query model with fragment.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-160" id="line-160">160</a>  
<a class="line-num" href="#line-161" id="line-161">161</a>      <span class="k">this</span><span class="p">.</span><span class="nx">_syncQueryModelFromFragment</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">fragment</span><span class="p">,</span> <span class="p">{</span><span class="nx">silent</span><span class="o">:</span> <span class="o">!</span><span class="p">(</span><span class="nx">options</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">trigger</span><span class="p">)});</span>
<a class="line-num" href="#line-162" id="line-162">162</a>  
<a class="line-num" href="#line-163" id="line-163">163</a>  
<a class="line-num" href="#line-164" id="line-164">164</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<p>Fire querystring routes after normal routes.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-163" id="line-163">163</a>  
<a class="line-num" href="#line-164" id="line-164">164</a>      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">trigger</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-165" id="line-165">165</a>        <span class="k">this</span><span class="p">.</span><span class="nx">loadQuery</span><span class="p">(</span><span class="nx">fragment</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<a class="line-num" href="#line-166" id="line-166">166</a>      <span class="p">}</span>
<a class="line-num" href="#line-167" id="line-167">167</a>  
<a class="line-num" href="#line-168" id="line-168">168</a>      <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
<a class="line-num" href="#line-169" id="line-169">169</a>    <span class="p">},</span>
<a class="line-num" href="#line-170" id="line-170">170</a>  
<a class="line-num" href="#line-171" id="line-171">171</a>  
<a class="line-num" href="#line-172" id="line-172">172</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Navigate a base route only, while maintaining the current query.
Strips any querystrings from the input fragment and appends
the current querystring.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{String} fragment Route fragment.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{Object} options  Navigation options.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-177" id="line-177">177</a>  
<a class="line-num" href="#line-178" id="line-178">178</a>    <span class="nx">navigateBase</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fragment</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-179" id="line-179">179</a>      <span class="kd">var</span> <span class="nx">currentQuery</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_fragmentToQueryString</span><span class="p">(</span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">fragment</span><span class="p">);</span>
<a class="line-num" href="#line-180" id="line-180">180</a>      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">navigate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_stripQuery</span><span class="p">(</span><span class="nx">fragment</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;?&quot;</span> <span class="o">+</span> <span class="nx">currentQuery</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<a class="line-num" href="#line-181" id="line-181">181</a>    <span class="p">},</span>
<a class="line-num" href="#line-182" id="line-182">182</a>  
<a class="line-num" href="#line-183" id="line-183">183</a>  
<a class="line-num" href="#line-184" id="line-184">184</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>When the query model changes, navigate.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{Model}  model   Attached model.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{Object} options Change options (currently ignored).</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-187" id="line-187">187</a>  
<a class="line-num" href="#line-188" id="line-188">188</a>    <span class="nx">onQueryModelChange</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-189" id="line-189">189</a>      <span class="kd">var</span> <span class="nx">baseRoute</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_stripQuery</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">fragment</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
<a class="line-num" href="#line-190" id="line-190">190</a>  
<a class="line-num" href="#line-191" id="line-191">191</a>  
<a class="line-num" href="#line-192" id="line-192">192</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>Write the new querystring.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-191" id="line-191">191</a>  
<a class="line-num" href="#line-192" id="line-192">192</a>      <span class="k">this</span><span class="p">.</span><span class="nx">navigate</span><span class="p">(</span><span class="nx">baseRoute</span> <span class="o">+</span> <span class="s1">&#39;?&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span> <span class="p">{</span><span class="nx">trigger</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
<a class="line-num" href="#line-193" id="line-193">193</a>    <span class="p">},</span>
<a class="line-num" href="#line-194" id="line-194">194</a>  
<a class="line-num" href="#line-195" id="line-195">195</a>  
<a class="line-num" href="#line-196" id="line-196">196</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Add a query to be tested when the fragment changes.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{Array}   bindings  Query keys to listen to.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{Function} callback Callback to call when these keys change.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-199" id="line-199">199</a>  
<a class="line-num" href="#line-200" id="line-200">200</a>    <span class="nx">queryHandler</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">bindings</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-201" id="line-201">201</a>      <span class="k">this</span><span class="p">.</span><span class="nx">queryHandlers</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">bindings</span><span class="o">:</span> <span class="nx">bindings</span><span class="p">,</span> <span class="nx">callback</span><span class="o">:</span> <span class="nx">callback</span><span class="p">});</span>
<a class="line-num" href="#line-202" id="line-202">202</a>    <span class="p">},</span>
<a class="line-num" href="#line-203" id="line-203">203</a>  
<a class="line-num" href="#line-204" id="line-204">204</a>  
<a class="line-num" href="#line-205" id="line-205">205</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Reset the internal query model to a certain state. Performs set() and unset() internally
to reset the model's attributes to the correct state, while firing the correct events.
Similar to Backbone.Collection.reset(), but with model attributes rather than models.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">queryObject</span>
      <span class="dox_type">Object</span>
      <span>New query object.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">queryString</span>
      <span class="dox_type">String</span>
      <span>New query string.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-212" id="line-212">212</a>  
<a class="line-num" href="#line-213" id="line-213">213</a>    <span class="nx">resetQuery</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">queryObject</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-214" id="line-214">214</a>  
<a class="line-num" href="#line-215" id="line-215">215</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26">&#182;</a>
</div>
<p>Alternate usage</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-214" id="line-214">214</a>  
<a class="line-num" href="#line-215" id="line-215">215</a>      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">queryObject</span><span class="p">))</span> <span class="p">{</span>
<a class="line-num" href="#line-216" id="line-216">216</a>        <span class="k">if</span> <span class="p">(</span><span class="nx">queryObject</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="nx">queryObject</span> <span class="o">=</span> <span class="s1">&#39;?&#39;</span> <span class="o">+</span> <span class="nx">queryObject</span><span class="p">;</span>
<a class="line-num" href="#line-217" id="line-217">217</a>        <span class="nx">queryObject</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_fragmentToQueryObject</span><span class="p">(</span><span class="nx">queryObject</span><span class="p">);</span>
<a class="line-num" href="#line-218" id="line-218">218</a>      <span class="p">}</span>
<a class="line-num" href="#line-219" id="line-219">219</a>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">)</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{};</span>
<a class="line-num" href="#line-220" id="line-220">220</a>      <span class="kd">var</span> <span class="nx">queryModel</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">query</span><span class="p">;</span>
<a class="line-num" href="#line-221" id="line-221">221</a>  
<a class="line-num" href="#line-222" id="line-222">222</a>  
<a class="line-num" href="#line-223" id="line-223">223</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<p>Suppresses intermediate 'change' events; 'change:key' will still fire.
This has the added benefit of making the internal <code>changed</code> hash actually
correct for this operation, which means previousAttributes() and changedAttributes()
will actually work correctly.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-225" id="line-225">225</a>  
<a class="line-num" href="#line-226" id="line-226">226</a>      <span class="nx">queryModel</span><span class="p">.</span><span class="nx">_changing</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
<a class="line-num" href="#line-227" id="line-227">227</a>  
<a class="line-num" href="#line-228" id="line-228">228</a>  
<a class="line-num" href="#line-229" id="line-229">229</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28">&#182;</a>
</div>
<p>Unset any keys inside the existing query. To disable,
set <code>{unset: false}</code> in the options.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-229" id="line-229">229</a>  
<a class="line-num" href="#line-230" id="line-230">230</a>      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">unset</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-231" id="line-231">231</a>        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">queryModel</span><span class="p">.</span><span class="nx">attributes</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">key</span><span class="p">){</span>
<a class="line-num" href="#line-232" id="line-232">232</a>          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">queryObject</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span> <span class="nx">queryModel</span><span class="p">.</span><span class="nx">unset</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
<a class="line-num" href="#line-233" id="line-233">233</a>        <span class="p">});</span>
<a class="line-num" href="#line-234" id="line-234">234</a>      <span class="p">}</span>
<a class="line-num" href="#line-235" id="line-235">235</a>  
<a class="line-num" href="#line-236" id="line-236">236</a>  
<a class="line-num" href="#line-237" id="line-237">237</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29">&#182;</a>
</div>
<p>Set new keys. To disable, set <code>{set: false}</code> in the options.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-236" id="line-236">236</a>  
<a class="line-num" href="#line-237" id="line-237">237</a>      <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">set</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-238" id="line-238">238</a>        <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">queryObject</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">key</span><span class="p">){</span>
<a class="line-num" href="#line-239" id="line-239">239</a>          <span class="nx">queryModel</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">attr</span><span class="p">);</span>
<a class="line-num" href="#line-240" id="line-240">240</a>        <span class="p">});</span>
<a class="line-num" href="#line-241" id="line-241">241</a>      <span class="p">}</span>
<a class="line-num" href="#line-242" id="line-242">242</a>  
<a class="line-num" href="#line-243" id="line-243">243</a>  
<a class="line-num" href="#line-244" id="line-244">244</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30">&#182;</a>
</div>
<p>Unset changing flag and fire change event.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-243" id="line-243">243</a>  
<a class="line-num" href="#line-244" id="line-244">244</a>      <span class="nx">queryModel</span><span class="p">.</span><span class="nx">_changing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<a class="line-num" href="#line-245" id="line-245">245</a>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">silent</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">_</span><span class="p">.</span><span class="nx">isEmpty</span><span class="p">(</span><span class="nx">queryModel</span><span class="p">.</span><span class="nx">changed</span><span class="p">)){</span>
<a class="line-num" href="#line-246" id="line-246">246</a>        <span class="nx">queryModel</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="nx">queryModel</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<a class="line-num" href="#line-247" id="line-247">247</a>      <span class="p">}</span>
<a class="line-num" href="#line-248" id="line-248">248</a>    <span class="p">},</span>
<a class="line-num" href="#line-249" id="line-249">249</a>  
<a class="line-num" href="#line-250" id="line-250">250</a>  
<a class="line-num" href="#line-251" id="line-251">251</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>When Backbone.history initializes, also load the current query.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Boolean</span>
      <span>Route matching status from Backbone.history.loadUrl.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-253" id="line-253">253</a>  
<a class="line-num" href="#line-254" id="line-254">254</a>    <span class="nx">start</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<a class="line-num" href="#line-255" id="line-255">255</a>      <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">History</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">start</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
<a class="line-num" href="#line-256" id="line-256">256</a>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">silent</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">loadQuery</span><span class="p">();</span>
<a class="line-num" href="#line-257" id="line-257">257</a>      <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
<a class="line-num" href="#line-258" id="line-258">258</a>    <span class="p">},</span>
<a class="line-num" href="#line-259" id="line-259">259</a>  
<a class="line-num" href="#line-260" id="line-260">260</a>  
<a class="line-num" href="#line-261" id="line-261">261</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Given two objects, compute their differences and list them.
This does not support nested objects.</p>
  </div>
  <div class="body"><p>Deleted, added, or changed keys are considered diffs.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{Object} lhs Left hand object.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{Object} rhs Right hand (new) object.</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Array</span>
      <span>Array of string differences.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-273" id="line-273">273</a>  
<a class="line-num" href="#line-274" id="line-274">274</a>    <span class="nx">_getDiffs</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">lhs</span><span class="p">,</span> <span class="nx">rhs</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-275" id="line-275">275</a>      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">chain</span><span class="p">(</span><span class="nx">lhs</span><span class="p">)</span>
<a class="line-num" href="#line-276" id="line-276">276</a>        <span class="p">.</span><span class="nx">keys</span><span class="p">()</span>
<a class="line-num" href="#line-277" id="line-277">277</a>        <span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">rhs</span><span class="p">))</span>
<a class="line-num" href="#line-278" id="line-278">278</a>        <span class="p">.</span><span class="nx">reduce</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">key</span><span class="p">){</span>
<a class="line-num" href="#line-279" id="line-279">279</a>          <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">result</span><span class="p">(</span><span class="nx">lhs</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="s1">&#39;toString&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="nx">_</span><span class="p">.</span><span class="nx">result</span><span class="p">(</span><span class="nx">rhs</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="s1">&#39;toString&#39;</span><span class="p">))</span> <span class="p">{</span>
<a class="line-num" href="#line-280" id="line-280">280</a>            <span class="nx">result</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
<a class="line-num" href="#line-281" id="line-281">281</a>          <span class="p">}</span>
<a class="line-num" href="#line-282" id="line-282">282</a>          <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
<a class="line-num" href="#line-283" id="line-283">283</a>        <span class="p">},</span> <span class="p">[])</span>
<a class="line-num" href="#line-284" id="line-284">284</a>        <span class="p">.</span><span class="nx">uniq</span><span class="p">()</span>
<a class="line-num" href="#line-285" id="line-285">285</a>        <span class="p">.</span><span class="nx">value</span><span class="p">();</span>
<a class="line-num" href="#line-286" id="line-286">286</a>    <span class="p">},</span>
<a class="line-num" href="#line-287" id="line-287">287</a>  
<a class="line-num" href="#line-288" id="line-288">288</a>  
<a class="line-num" href="#line-289" id="line-289">289</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Given a fragment, return a query object.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{String} fragment Route fragment.</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Object</span>
      <span>Query object.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-292" id="line-292">292</a>  
<a class="line-num" href="#line-293" id="line-293">293</a>    <span class="nx">_fragmentToQueryObject</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fragment</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-294" id="line-294">294</a>      <span class="k">try</span> <span class="p">{</span>
<a class="line-num" href="#line-295" id="line-295">295</a>        <span class="k">return</span> <span class="nx">querystring</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_fragmentToQueryString</span><span class="p">(</span><span class="nx">fragment</span><span class="p">));</span>
<a class="line-num" href="#line-296" id="line-296">296</a>      <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-297" id="line-297">297</a>        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;Unable to parse fragment into query object: &quot;</span> <span class="o">+</span> <span class="nx">fragment</span><span class="p">);</span>
<a class="line-num" href="#line-298" id="line-298">298</a>      <span class="p">}</span>
<a class="line-num" href="#line-299" id="line-299">299</a>    <span class="p">},</span>
<a class="line-num" href="#line-300" id="line-300">300</a>  
<a class="line-num" href="#line-301" id="line-301">301</a>  
<a class="line-num" href="#line-302" id="line-302">302</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Given a fragment, return a query string.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{String} fragment Route fragment.</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">String</span>
      <span>Query string.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-305" id="line-305">305</a>  
<a class="line-num" href="#line-306" id="line-306">306</a>    <span class="nx">_fragmentToQueryString</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fragment</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-307" id="line-307">307</a>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">fragment</span><span class="p">)</span> <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<a class="line-num" href="#line-308" id="line-308">308</a>      <span class="kd">var</span> <span class="nx">match</span> <span class="o">=</span> <span class="nx">fragment</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">queryMatcher</span><span class="p">);</span>
<a class="line-num" href="#line-309" id="line-309">309</a>      <span class="k">return</span> <span class="nx">match</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<a class="line-num" href="#line-310" id="line-310">310</a>    <span class="p">},</span>
<a class="line-num" href="#line-311" id="line-311">311</a>  
<a class="line-num" href="#line-312" id="line-312">312</a>  
<a class="line-num" href="#line-313" id="line-313">313</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Synchronize the internal query model with the fragment.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">fragment</span>
      <span class="dox_type">String</span>
      <span>Route fragment.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">options</span>
      <span class="dox_type">Object</span>
      <span>Options.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">[options.trigger]</span>
      <span class="dox_type">Boolean</span>
      <span>If true will not fire change events.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-317" id="line-317">317</a>  
<a class="line-num" href="#line-318" id="line-318">318</a>    <span class="nx">_syncQueryModelFromFragment</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fragment</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-319" id="line-319">319</a>  
<a class="line-num" href="#line-320" id="line-320">320</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36">&#182;</a>
</div>
<p>Set internal query object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-319" id="line-319">319</a>  
<a class="line-num" href="#line-320" id="line-320">320</a>      <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_fragmentToQueryObject</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">fragment</span><span class="p">);</span>
<a class="line-num" href="#line-321" id="line-321">321</a>  
<a class="line-num" href="#line-322" id="line-322">322</a>  
<a class="line-num" href="#line-323" id="line-323">323</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37">&#182;</a>
</div>
<p>Set embedded model to new query object, firing 'change' events when necessary.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-322" id="line-322">322</a>  
<a class="line-num" href="#line-323" id="line-323">323</a>      <span class="k">this</span><span class="p">.</span><span class="nx">stopListening</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onQueryModelChange</span><span class="p">);</span>
<a class="line-num" href="#line-324" id="line-324">324</a>      <span class="k">this</span><span class="p">.</span><span class="nx">resetQuery</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<a class="line-num" href="#line-325" id="line-325">325</a>      <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">query</span><span class="p">,</span> <span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">onQueryModelChange</span><span class="p">);</span>
<a class="line-num" href="#line-326" id="line-326">326</a>    <span class="p">},</span>
<a class="line-num" href="#line-327" id="line-327">327</a>  
<a class="line-num" href="#line-328" id="line-328">328</a>  
<a class="line-num" href="#line-329" id="line-329">329</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Strip a querystring from a fragment.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{String} fragment Route fragment.</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">String</span>
      <span>Fragment without query.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-332" id="line-332">332</a>  
<a class="line-num" href="#line-333" id="line-333">333</a>    <span class="nx">_stripQuery</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fragment</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-334" id="line-334">334</a>      <span class="k">return</span> <span class="nx">fragment</span> <span class="o">?</span> <span class="nx">fragment</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<a class="line-num" href="#line-335" id="line-335">335</a>    <span class="p">}</span>
<a class="line-num" href="#line-336" id="line-336">336</a>  <span class="p">});</span>
<a class="line-num" href="#line-337" id="line-337">337</a>  
<a class="line-num" href="#line-338" id="line-338">338</a>  <span class="kd">var</span> <span class="nx">RouterProto</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">prototype</span><span class="p">;</span>
<a class="line-num" href="#line-339" id="line-339">339</a>  
<a class="line-num" href="#line-340" id="line-340">340</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Backbone.Router overrides.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Type</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Backbone.Router
</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-342" id="line-342">342</a>  
<a class="line-num" href="#line-343" id="line-343">343</a>  <span class="kd">var</span> <span class="nx">QueryRouter</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="cm">/** @lends QueryRouter# */</span><span class="p">{</span>
<a class="line-num" href="#line-344" id="line-344">344</a>  
<a class="line-num" href="#line-345" id="line-345">345</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Bind query routes.</p>
  </div>
  <div class="body"><p>Remember that handlers will only fire once per navigation. If for some reason you'd like
a handler to fire for each individual change, bind to the 'change:{key}' events on 
Backbone.history.query, which is just a Backbone.Model (and fires all of the usual
events).</p>

<p>They are expected to be attached in the following configuration:</p>


<div class="highlight"><pre><code><span class="nx">queryRoutes</span><span class="o">:</span> <span class="p">[</span>
  <span class="s1">&#39;key1,key2,key3&#39;</span><span class="o">:</span> <span class="s1">&#39;handlerName&#39;</span><span class="p">,</span>
  <span class="s1">&#39;q, sort, rows&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// ... }</span>
<span class="p">]</span>
</code></pre></div>


  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-360" id="line-360">360</a>  
<a class="line-num" href="#line-361" id="line-361">361</a>    <span class="nx">_bindRoutes</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
<a class="line-num" href="#line-362" id="line-362">362</a>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">queryRoutes</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
<a class="line-num" href="#line-363" id="line-363">363</a>      <span class="k">this</span><span class="p">.</span><span class="nx">queryRoutes</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">result</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="s1">&#39;queryRoutes&#39;</span><span class="p">);</span>
<a class="line-num" href="#line-364" id="line-364">364</a>      <span class="kd">var</span> <span class="nx">qRoute</span><span class="p">,</span> <span class="nx">qRoutes</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">queryRoutes</span><span class="p">);</span>
<a class="line-num" href="#line-365" id="line-365">365</a>      <span class="k">while</span> <span class="p">((</span><span class="nx">qRoute</span> <span class="o">=</span> <span class="nx">qRoutes</span><span class="p">.</span><span class="nx">pop</span><span class="p">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-366" id="line-366">366</a>        <span class="k">this</span><span class="p">.</span><span class="nx">queryHandler</span><span class="p">(</span><span class="nx">qRoute</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">queryRoutes</span><span class="p">[</span><span class="nx">qRoute</span><span class="p">]);</span>
<a class="line-num" href="#line-367" id="line-367">367</a>      <span class="p">}</span>
<a class="line-num" href="#line-368" id="line-368">368</a>      <span class="nx">RouterProto</span><span class="p">.</span><span class="nx">_bindRoutes</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
<a class="line-num" href="#line-369" id="line-369">369</a>    <span class="p">},</span>
<a class="line-num" href="#line-370" id="line-370">370</a>  
<a class="line-num" href="#line-371" id="line-371">371</a>  
<a class="line-num" href="#line-372" id="line-372">372</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Navigate a base route only, while maintaining the current query.
Delegates to <code>Backbone.history.navigateBase</code>.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{String} fragment Route fragment.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{Object} options  Navigation options.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-376" id="line-376">376</a>  
<a class="line-num" href="#line-377" id="line-377">377</a>    <span class="nx">navigateBase</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fragment</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-378" id="line-378">378</a>      <span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">navigateBase</span><span class="p">(</span><span class="nx">fragment</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
<a class="line-num" href="#line-379" id="line-379">379</a>      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<a class="line-num" href="#line-380" id="line-380">380</a>    <span class="p">},</span>
<a class="line-num" href="#line-381" id="line-381">381</a>  
<a class="line-num" href="#line-382" id="line-382">382</a>  
<a class="line-num" href="#line-383" id="line-383">383</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Bind a queryHandler. Very similar to Backbone.Router#route, except that args
are provided by Backbone.history#queryHandler, rather than being extracted
in the router from the fragment.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{String|array}  bindings Query key bindings.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{String}   [name]        Listener name.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{Function} callback      Listener callback.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-389" id="line-389">389</a>  
<a class="line-num" href="#line-390" id="line-390">390</a>    <span class="nx">queryHandler</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">bindings</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-391" id="line-391">391</a>      <span class="nx">bindings</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_normalizeBindings</span><span class="p">(</span><span class="nx">bindings</span><span class="p">);</span>
<a class="line-num" href="#line-392" id="line-392">392</a>      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">name</span><span class="p">))</span> <span class="p">{</span>
<a class="line-num" href="#line-393" id="line-393">393</a>        <span class="nx">callback</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
<a class="line-num" href="#line-394" id="line-394">394</a>        <span class="nx">name</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
<a class="line-num" href="#line-395" id="line-395">395</a>      <span class="p">}</span>
<a class="line-num" href="#line-396" id="line-396">396</a>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">callback</span><span class="p">)</span> <span class="nx">callback</span> <span class="o">=</span> <span class="k">this</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
<a class="line-num" href="#line-397" id="line-397">397</a>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">callback</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;QueryHandler not found: &quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">[</span><span class="nx">name</span><span class="p">]);</span>
<a class="line-num" href="#line-398" id="line-398">398</a>      <span class="kd">var</span> <span class="nx">router</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
<a class="line-num" href="#line-399" id="line-399">399</a>      <span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">queryHandler</span><span class="p">(</span><span class="nx">bindings</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fragment</span><span class="p">,</span> <span class="nx">queryObj</span><span class="p">,</span> <span class="nx">queryKeys</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-400" id="line-400">400</a>  
<a class="line-num" href="#line-401" id="line-401">401</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43">&#182;</a>
</div>
<p>Emulate method signatures used on normal routes</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-400" id="line-400">400</a>  
<a class="line-num" href="#line-401" id="line-401">401</a>        <span class="nx">router</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="p">[</span><span class="nx">queryObj</span><span class="p">,</span> <span class="nx">queryKeys</span><span class="p">]);</span>
<a class="line-num" href="#line-402" id="line-402">402</a>        <span class="nx">router</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;route:&#39;</span> <span class="o">+</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">queryKeys</span><span class="p">,</span> <span class="nx">queryObj</span><span class="p">);</span>
<a class="line-num" href="#line-403" id="line-403">403</a>        <span class="nx">router</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;route&#39;</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="p">[</span><span class="nx">queryObj</span><span class="p">,</span> <span class="nx">queryKeys</span><span class="p">]);</span>
<a class="line-num" href="#line-404" id="line-404">404</a>        <span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s1">&#39;route&#39;</span><span class="p">,</span> <span class="nx">router</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="p">[</span><span class="nx">queryObj</span><span class="p">,</span> <span class="nx">queryKeys</span><span class="p">]);</span>
<a class="line-num" href="#line-405" id="line-405">405</a>      <span class="p">});</span>
<a class="line-num" href="#line-406" id="line-406">406</a>      <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
<a class="line-num" href="#line-407" id="line-407">407</a>    <span class="p">},</span>
<a class="line-num" href="#line-408" id="line-408">408</a>  
<a class="line-num" href="#line-409" id="line-409">409</a>  
<a class="line-num" href="#line-410" id="line-410">410</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Normalize bindings - convert to array and trim whitespace.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span>{String} bindings Bindings definition.</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Array</span>
      <span>Normalized bindings.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-413" id="line-413">413</a>  
<a class="line-num" href="#line-414" id="line-414">414</a>    <span class="nx">_normalizeBindings</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">bindings</span><span class="p">)</span> <span class="p">{</span>
<a class="line-num" href="#line-415" id="line-415">415</a>      <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">bindings</span><span class="p">))</span> <span class="p">{</span>
<a class="line-num" href="#line-416" id="line-416">416</a>        <span class="nx">bindings</span> <span class="o">=</span> <span class="nx">bindings</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">);</span>
<a class="line-num" href="#line-417" id="line-417">417</a>      <span class="p">}</span>
<a class="line-num" href="#line-418" id="line-418">418</a>      <span class="k">return</span> <span class="nx">_</span><span class="p">.</span><span class="nx">invoke</span><span class="p">(</span><span class="nx">bindings</span><span class="p">,</span> <span class="s1">&#39;trim&#39;</span><span class="p">);</span>
<a class="line-num" href="#line-419" id="line-419">419</a>    <span class="p">}</span>
<a class="line-num" href="#line-420" id="line-420">420</a>  <span class="p">});</span>
<a class="line-num" href="#line-421" id="line-421">421</a>  
<a class="line-num" href="#line-422" id="line-422">422</a>  
<a class="line-num" href="#line-423" id="line-423">423</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45">&#182;</a>
</div>
<p>Override default Backbone.Router constructor.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-422" id="line-422">422</a>  
<a class="line-num" href="#line-423" id="line-423">423</a>  <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Router</span> <span class="o">=</span> <span class="nx">QueryRouter</span><span class="p">;</span>
<a class="line-num" href="#line-424" id="line-424">424</a>  
<a class="line-num" href="#line-425" id="line-425">425</a>  
<a class="line-num" href="#line-426" id="line-426">426</a>  </pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46">&#182;</a>
</div>
<p>Replace Backbone.history.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><a class="line-num" href="#line-425" id="line-425">425</a>  
<a class="line-num" href="#line-426" id="line-426">426</a>  <span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">QueryHistory</span><span class="p">();</span>
<a class="line-num" href="#line-427" id="line-427">427</a>  </pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
